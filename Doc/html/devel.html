<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Rozdział 4. Dla developerów</title><link rel="stylesheet" type="text/css" href="static/aquapi.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.76.1" /><link rel="home" href="index.html" title="Komputer akwariowy AquaPi" /><link rel="up" href="index.html" title="Komputer akwariowy AquaPi" /><link rel="prev" href="configuredb.html" title="3.2. Pozostałe opcje konfiguracyjne" /><link rel="next" href="daemon.html" title="4.2. Demon" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Rozdział 4. Dla developerów</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="configuredb.html">Poprzedni</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="daemon.html">Następny</a></td></tr></table><hr /></div><div class="chapter" title="Rozdział 4. Dla developerów"><div class="titlepage"><div><div><h2 class="title"><a id="devel"></a>Rozdział 4. Dla developerów</h2></div></div></div><div class="toc"><p><strong>Spis treści</strong></p><dl><dt><span class="sect1"><a href="devel.html#database">4.1. Baza danych</a></span></dt><dt><span class="sect1"><a href="daemon.html">4.2. Demon</a></span></dt><dt><span class="sect1"><a href="device-names.html">4.3. Nazewnictwo urządzeń</a></span></dt></dl></div><div class="sect1" title="4.1. Baza danych"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="database"></a>4.1. Baza danych</h2></div></div></div><p>
        Ten rozdział opisuje strukturę bazy MySQL. Przedstawiono w nim schemat poszczególnych tabel.
        Opis każdej tabeli składa się z siedmiu kolumn. Znaczenie poszczególnych kolumn to:
		</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Nazwa pola</p></li><li class="listitem"><p>Typ przechowywanych danych</p></li><li class="listitem"><p>Wartość logiczna określająca, czy dane pole w tabeli może przechowywać wartość niezdefiniowaną (null).</p></li><li class="listitem"><p>Typ klucza. Może przyjmować jedną z wartości:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>PRI - oznacza, że kolumna to klucz podstawowy</p></li><li class="listitem"><p>MUL - ???</p></li><li class="listitem"><p>UNI - oznacza, że wartość przechowywana w tym polu jest unikalna dla całej tabeli</p></li></ul></div></li><li class="listitem"><p>Wartość domyślna jaką przyjmie baza danych w przypadku kiedy nie zostanie podana żadna wartość. Znak myślnika oznacza, że pole nie ma zdefiniowanej domyślnej wartości.</p></li><li class="listitem"><p>Określa dodatkowe właściwości pola. Może przyjmować jedną z wartości:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>auto_increment - oznacza, że kolejno dodawane rekordy będą automatycznie inkrementowane</p></li></ul></div></li><li class="listitem"><p>Dodatkowe informacje dotyczące danego pola</p></li></ol></div><p>
        Schemat bazy danych nie zawiera pól typu <code class="code">DATETIME</code>. Daty są przechowywane w formacie timestamp<sup>[<a id="timestamp" href="#ftn.timestamp" class="footnote">1</a>]</sup> w polu o typie <code class="code">INT</code>. 
    </p><div class="table"><a id="idp18577424"></a><p class="title"><strong>Tabela 4.1. Spis tabel</strong></p><div class="table-contents"><table summary="Spis tabel" border="1"><colgroup><col align="left" class="Nazwa" /><col align="left" class="Opis" /></colgroup><thead><tr><th align="left">Nazwa</th><th align="left">Opis</th></tr></thead><tbody><tr><td align="left">devices</td><td align="left">? - nie używana w demonie</td></tr><tr><td align="left">interfaces</td><td align="left">Zawiera dane interfejsów (wejść i wyjść)</td></tr><tr><td align="left">logs </td><td align="left">Zawiera logi systemowe</td></tr><tr><td align="left">settings</td><td align="left">Zawiera podstawowe ustawienia systemowe. Aktualnie nie używana w demonie</td></tr><tr><td align="left">stats </td><td align="left">Zawiera statystyki (dane odczytane z czujników)</td></tr><tr><td align="left">stats_view</td><td align="left">? - nie używana w demonie</td></tr><tr><td align="left">timers </td><td align="left">Zawiera spis timerów (zdarzeń)</td></tr></tbody></table></div></div><br class="table-break" /><div class="table"><a id="idp18671320"></a><p class="title"><strong>Tabela 4.2. Tabela devices</strong></p><div class="table-contents"><table summary="Tabela devices" border="1"><colgroup><col align="left" class="Pole" /><col align="left" class="Typ" /><col align="left" class="Null" /><col align="left" class="Klucz" /><col align="left" class="Domyślnie" /><col align="left" class="Ekstra" /><col align="left" class="Opis" /></colgroup><thead><tr><th align="left">Pole</th><th align="left">Typ</th><th align="left">Null</th><th align="left">Klucz</th><th align="left">Domyślnie</th><th align="left">Ekstra</th><th align="left">Opis</th></tr></thead><tbody><tr><td align="left">device_id</td><td align="left">int(5)</td><td align="left">NO</td><td align="left">PRI</td><td align="left"> </td><td align="left">auto_increment</td><td align="left"> </td></tr><tr><td align="left">device_name</td><td align="left">char(40)</td><td align="left">NO</td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td></tr><tr><td align="left">device_disabled</td><td align="left">tinyint(4)</td><td align="left">NO</td><td align="left"> </td><td align="left">0</td><td align="left"> </td><td align="left"> </td></tr><tr><td align="left">device_deleted</td><td align="left">tinyint(4)</td><td align="left">NO</td><td align="left"> </td><td align="left">0</td><td align="left"> </td><td align="left"> </td></tr></tbody></table></div></div><br class="table-break" /><div class="table"><a id="idp18710832"></a><p class="title"><strong>Tabela 4.3. Tabela interfaces</strong></p><div class="table-contents"><table summary="Tabela interfaces" border="1"><colgroup><col align="left" class="Pole" /><col align="left" class="Typ" /><col align="left" class="Null" /><col align="left" class="Klucz" /><col align="left" class="Domyślnie" /><col align="left" class="Ekstra" /><col align="left" class="Opis" /></colgroup><thead><tr><th align="left">Pole</th><th align="left">Typ</th><th align="left">Null</th><th align="left">Klucz</th><th align="left">Domyślnie</th><th align="left">Ekstra</th><th align="left">Opis</th></tr></thead><tbody><tr><td align="left">interface_id</td><td align="left">int(5)</td><td align="left">NO</td><td align="left">PRI</td><td align="left"> </td><td align="left">auto_increment</td><td align="left">Identyfikator</td></tr><tr><td align="left">interface_deviceid</td><td align="left">int(5)</td><td align="left">NO</td><td align="left">MUL</td><td align="left"> </td><td align="left"> </td><td align="left"> </td></tr><tr><td align="left">interface_address</td><td align="left">varchar(30)</td><td align="left">NO</td><td align="left">UNI</td><td align="left"> </td><td align="left"> </td><td align="left">Adres interfejsu. Dla wejść może zaczynać się od:
							<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>rpi:1w: - sensory temperatury podłączone do magistrali 1wire na GPIO.</p></li><li class="listitem"><p>dummy: - sensor dummy (wirtualny) przydatny przy rozwoju aplikacji</p></li></ul></div>
							Dla wyjść może zaczynać się od:
							<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>relbrd: - karta przekaźników RelayBoard (wersja USB)</p></li><li class="listitem"><p>rpi:gpio: - pin GPIO</p></li><li class="listitem"><p>dummy: - wyjście dummy (wirtualne) przydatne przy rozwoju aplikacji</p></li></ul></div>
						</td></tr><tr><td align="left">interface_name</td><td align="left">varchar(30)</td><td align="left">NO</td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left">Nazwa interfejsu. Przykładowe nazwy to "oświetlenie główne", "grzałka", etc.</td></tr><tr><td align="left">interface_type</td><td align="left">tinyint(4)</td><td align="left">NO</td><td align="left"> </td><td align="left">1</td><td align="left"> </td><td align="left">Typ interfejsu. Dopuszczalne wartości to:
							<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>0 - temperatura zadana (nie wykorzystywane w demonie)</p></li><li class="listitem"><p>1 - wejście (np. sensor temperatury)</p></li><li class="listitem"><p>2 - wyjście (np. port GPIO)</p></li></ul></div>						
						</td></tr><tr><td align="left">interface_corr</td><td align="left">varchar(6)</td><td align="left">NO</td><td align="left"> </td><td align="left">0</td><td align="left"> </td><td align="left">korekta wartosci sensora</td></tr><tr><td align="left">interface_draw</td><td align="left">tinyint(4)</td><td align="left">NO</td><td align="left"> </td><td align="left">1</td><td align="left"> </td><td align="left">czy pokazywac czujnik na wykresie</td></tr><tr><td align="left">interface_icon</td><td align="left">varchar(20)</td><td align="left">YES</td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left">Ikonka przypisana do urządzenia</td></tr><tr><td align="left">interface_conf</td><td align="left">float</td><td align="left">YES</td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left">Negowanie sygnału wyjściowego. Możliwe ustawienia
							<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>0 - standardowe działanie</p></li><li class="listitem"><p>1 - zanegowanie wyjścia. Dla tego ustawienia "wyłączony" w AquaPi będzie oznaczało "załączony" w rzeczywistości</p></li></ul></div>							
						</td></tr><tr><td align="left">interface_disabled</td><td align="left">tinyint(4)</td><td align="left">NO</td><td align="left"> </td><td align="left">0</td><td align="left"> </td><td align="left"> </td></tr><tr><td align="left">interface_deleted</td><td align="left">tinyint(4)</td><td align="left">NO</td><td align="left"> </td><td align="left">0</td><td align="left"> </td><td align="left">czy interfejs jest skasowany</td></tr></tbody></table></div></div><br class="table-break" /><div class="table"><a id="idp18735432"></a><p class="title"><strong>Tabela 4.4. Tabela logs</strong></p><div class="table-contents"><table summary="Tabela logs" border="1"><colgroup><col align="left" class="Pole" /><col align="left" class="Typ" /><col align="left" class="Null" /><col align="left" class="Klucz" /><col align="left" class="Domyślnie" /><col align="left" class="Ekstra" /><col align="left" class="Opis" /></colgroup><thead><tr><th align="left">Pole</th><th align="left">Typ</th><th align="left">Null</th><th align="left">Klucz</th><th align="left">Domyślnie</th><th align="left">Ekstra</th><th align="left">Opis</th></tr></thead><tbody><tr><td align="left">log_id</td><td align="left">int(5)</td><td align="left">NO</td><td align="left">PRI</td><td align="left"> </td><td align="left">auto_increment</td><td align="left">Identyfikator</td></tr><tr><td align="left">log_date</td><td align="left">int(5)</td><td align="left">NO</td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left">Znacznik czasu</td></tr><tr><td align="left">log_level</td><td align="left">int(5)</td><td align="left">NO</td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left">Typ loga. Możliwe wartości to:
							<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>0 - informacja</p></li><li class="listitem"><p>1 - ostrzeżenie</p></li><li class="listitem"><p>2 - błąd krytyczny</p></li></ul></div>
						</td></tr><tr><td align="left">log_value</td><td align="left">char(200)</td><td align="left">NO</td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left">Zawartość loga</td></tr></tbody></table></div></div><br class="table-break" /><div class="table"><a id="idp18746336"></a><p class="title"><strong>Tabela 4.5. Tabela settings</strong></p><div class="table-contents"><table summary="Tabela settings" border="1"><colgroup><col align="left" class="Pole" /><col align="left" class="Typ" /><col align="left" class="Null" /><col align="left" class="Klucz" /><col align="left" class="Domyślnie" /><col align="left" class="Ekstra" /><col align="left" class="Opis" /></colgroup><thead><tr><th align="left">Pole</th><th align="left">Typ</th><th align="left">Null</th><th align="left">Klucz</th><th align="left">Domyślnie</th><th align="left">Ekstra</th><th align="left">Opis</th></tr></thead><tbody><tr><td align="left">setting_id</td><td align="left">int(5)</td><td align="left">NO</td><td align="left">PRI</td><td align="left"> </td><td align="left">auto_increment</td><td align="left"> </td></tr><tr><td align="left">setting_key</td><td align="left">char(30)</td><td align="left">NO</td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td></tr><tr><td align="left">setting_value</td><td align="left">char(60)</td><td align="left">NO</td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td></tr></tbody></table></div></div><br class="table-break" /><div class="table"><a id="idp18754608"></a><p class="title"><strong>Tabela 4.6. Tabela stats</strong></p><div class="table-contents"><table summary="Tabela stats" border="1"><colgroup><col align="left" class="Pole" /><col align="left" class="Typ" /><col align="left" class="Null" /><col align="left" class="Klucz" /><col align="left" class="Domyślnie" /><col align="left" class="Ekstra" /><col align="left" class="Opis" /></colgroup><thead><tr><th align="left">Pole</th><th align="left">Typ</th><th align="left">Null</th><th align="left">Klucz</th><th align="left">Domyślnie</th><th align="left">Ekstra</th><th align="left">Opis</th></tr></thead><tbody><tr><td align="left">stat_id</td><td align="left">int(11)</td><td align="left">NO</td><td align="left">PRI</td><td align="left"> </td><td align="left">auto_increment</td><td align="left">Identyfikator</td></tr><tr><td align="left">stat_date</td><td align="left">int(11)</td><td align="left">YES</td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left">Znacznik czasu</td></tr><tr><td align="left">stat_interfaceid</td><td align="left">int(5)</td><td align="left">NO</td><td align="left">MUL</td><td align="left"> </td><td align="left"> </td><td align="left">Identyfikator interfejsu którego dotyczy zachowana wartość</td></tr><tr><td align="left">stat_value</td><td align="left">float</td><td align="left">NO</td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left">Wartość odczytana z interfejsu</td></tr></tbody></table></div></div><br class="table-break" /><div class="table"><a id="idp18764680"></a><p class="title"><strong>Tabela 4.7. Tabela stats_view</strong></p><div class="table-contents"><table summary="Tabela stats_view" border="1"><colgroup><col align="left" class="Pole" /><col align="left" class="Typ" /><col align="left" class="Null" /><col align="left" class="Klucz" /><col align="left" class="Domyślnie" /><col align="left" class="Ekstra" /><col align="left" class="Opis" /></colgroup><thead><tr><th align="left">Pole</th><th align="left">Typ</th><th align="left">Null</th><th align="left">Klucz</th><th align="left">Domyślnie</th><th align="left">Ekstra</th><th align="left">Opis</th></tr></thead><tbody><tr><td align="left">stat_id</td><td align="left">int(11)</td><td align="left">NO</td><td align="left"> </td><td align="left">0</td><td align="left"> </td><td align="left"> </td></tr><tr><td align="left">stat_date</td><td align="left">int(11)</td><td align="left">YES</td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td></tr><tr><td align="left">stat_interfaceid</td><td align="left">int(5)</td><td align="left">NO</td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td></tr><tr><td align="left">stat_value</td><td align="left">float</td><td align="left">NO</td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td></tr><tr><td align="left">stat_data</td><td align="left">datetime</td><td align="left">YES</td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td></tr></tbody></table></div></div><br class="table-break" /><div class="table"><a id="idp18775448"></a><p class="title"><strong>Tabela 4.8. Tabela timers</strong></p><div class="table-contents"><table summary="Tabela timers" border="1"><colgroup><col align="left" class="Pole" /><col align="left" class="Typ" /><col align="left" class="Null" /><col align="left" class="Klucz" /><col align="left" class="Domyślnie" /><col align="left" class="Ekstra" /><col align="left" class="Opis" /></colgroup><thead><tr><th align="left">Pole</th><th align="left">Typ</th><th align="left">Null</th><th align="left">Klucz</th><th align="left">Domyślnie</th><th align="left">Ekstra</th><th align="left">Opis</th></tr></thead><tbody><tr><td align="left">timer_id</td><td align="left">int(5)</td><td align="left">NO</td><td align="left">PRI</td><td align="left"> </td><td align="left">auto_increment</td><td align="left">Identyfikator</td></tr><tr><td align="left">timer_type</td><td align="left">tinyint(4)</td><td align="left">NO</td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left">Rodzaj triggera. Możliwe wartości to:
							<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>1 - trigger wyzwalany czasem</p></li><li class="listitem"><p>2 - trigger wyzwalany czujnikiem</p></li></ul></div>
						</td></tr><tr><td align="left">timer_timeif</td><td align="left">int(5)</td><td align="left">YES</td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left">Uproszczony znacznik czasu informujący kiedy timer ma być aktywny. W odróżnieniu od zwykłego znacznika, ten zawiera liczbę sekund która upłyneła od północy. W połączeniu z timer_direction decyduje czy timer jest w danym momencie aktywny, czy nie.</td></tr><tr><td align="left">timer_interfaceidif</td><td align="left">int(5)</td><td align="left">YES</td><td align="left">MUL</td><td align="left"> </td><td align="left"> </td><td align="left">Identyfikator interfejsu z którego odczytać dane - dotyczy zdarzeń sterowanych wartością z interfejsu</td></tr><tr><td align="left">timer_direction</td><td align="left">tinyint(4)</td><td align="left">NO</td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left">"Kierunek" triggera. Dla triggerów sterowanych czujnikiem:
							<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>1 - przełącz interfejs jeśli wartość odczytana z sensora jest większa niż podana w timer_value</p></li><li class="listitem"><p>2 - przełącz interfejs jeśli wartość odczytana z sensora jest mniejsza niż podana w timer_value</p></li></ul></div>
							Dla triggerów sterowanych czasem:
							<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>1 - przełącz interfejs jeśli aktualnie jest po czasie podanym w timer_timeif</p></li><li class="listitem"><p>2 - przełącz interfejs jeśli aktualnie jest przed czasem podanym w timer_timeif</p></li></ul></div>							
						</td></tr><tr><td align="left">timer_value</td><td align="left">float</td><td align="left">YES</td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left">Wartosc interfejsu na którą reagujemy</td></tr><tr><td align="left">timer_action</td><td align="left">tinyint(4)</td><td align="left">NO</td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left">Nowa wartość dla interfejsu przełączanego. 0 - wyłacz, 1-włacz</td></tr><tr><td align="left">timer_interfaceidthen</td><td align="left">int(5)</td><td align="left">NO</td><td align="left">MUL</td><td align="left"> </td><td align="left"> </td><td align="left">Identyfikator interfejsu który ma być przyłączony jeśli warunki zdarzenia są spełnione</td></tr><tr><td align="left">timer_days</td><td align="left">varchar(7)</td><td align="left">NO</td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left">Dni tygodnia w kórych timer powinien być sprawdzany. Dni są zapisane jako ciąg zer i jedynek. Od lewej strony zaczynając dni to: niedziela, poniedziałek, wtorek, środa, czwartek, piątek, sobota.</td></tr></tbody></table></div></div><br class="table-break" /></div><div class="footnotes"><br /><hr width="100" align="left" /><div class="footnote"><p><sup>[<a id="ftn.timestamp" href="#timestamp" class="para">1</a>] </sup>
        Przechowywanie daty w formacie timestamp polega na zapisaniu liczby sekund
        od daty 1/01/1970, czyli od momentu początku epoki unixa.
    </p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="configuredb.html">Poprzedni</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="daemon.html">Następny</a></td></tr><tr><td width="40%" align="left" valign="top">3.2. Pozostałe opcje konfiguracyjne </td><td width="20%" align="center"><a accesskey="h" href="index.html">Spis treści</a></td><td width="40%" align="right" valign="top"> 4.2. Demon</td></tr></table></div></body></html>
